![Build](https://github.com/embabel/embabel-agent/actions/workflows/maven.yml/badge.svg)

![Java](https://img.shields.io/badge/java-%23ED8B00.svg?style=for-the-badge&logo=openjdk&logoColor=white)
![Spring](https://img.shields.io/badge/spring-%236DB33F.svg?style=for-the-badge&logo=spring&logoColor=white)
![Apache Tomcat](https://img.shields.io/badge/apache%20tomcat-%23F8DC75.svg?style=for-the-badge&logo=apache-tomcat&logoColor=black)
![Apache Maven](https://img.shields.io/badge/Apache%20Maven-C71A36?style=for-the-badge&logo=Apache%20Maven&logoColor=white)
![ChatGPT](https://img.shields.io/badge/chatGPT-74aa9c?style=for-the-badge&logo=openai&logoColor=white)
![JSON](https://img.shields.io/badge/JSON-000?logo=json&logoColor=fff)
![GitHub Actions](https://img.shields.io/badge/github%20actions-%232671E5.svg?style=for-the-badge&logo=githubactions&logoColor=white)
![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white)
![IntelliJ IDEA](https://img.shields.io/badge/IntelliJIDEA-000000.svg?style=for-the-badge&logo=intellij-idea&logoColor=white)

<img align="left" src="https://github.com/embabel/embabel-agent/blob/main/embabel-agent-api/images/315px-Meister_der_Weltenchronik_001.jpg?raw=true" width="180">

&nbsp;&nbsp;&nbsp;&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;

# Generated agent

Java agent repository generated by the Embabel project creator.

Starting point for your own agent development using the [Embabel framework](https://github.com/embabel/embabel-agent).

Add your magic here!

Illustrates:

- A simple agent
- Unit tests for an agent verifying prompts and hyperparameters

# To run

Run the shell script to start Embabel under Spring Shell:

```bash
mvn spring-boot:run
```

There is a single example agent, `WriteAndReviewAgent`.
It uses one LLM with a high temperature and creative persona to write a story based on your input,
then another LLM with a low temperature and different persona to review the story.

When the Embabel shell comes up, use the story agent like this:

```
x "Tell me a story about...[your topic]"
```

## Complete Workflow Sequence

This diagram shows the complete end-to-end workflow from system startup to story generation using GOAP dynamic planning:

```mermaid
sequenceDiagram
    participant User as User
    participant Maven as Maven
    participant Spring as Spring Boot
    participant Embabel as Embabel Platform
    participant Ollama as Ollama Service
    participant GOAP as GOAP Planner
    participant Agent as WriteAndReviewAgent
    participant Shell as Spring Shell

    %% Build and Startup Phase
    User->>Maven: mvn spring-boot:run
    Maven->>Maven: Compile 2 source files + 1 test file
    Maven->>Spring: Start Spring Boot application
    
    Spring->>Spring: Activate profiles: "ollama", "starwars", "shell"
    Spring->>Embabel: Initialize AgentPlatformAutoConfiguration
    
    %% Model Discovery Phase
    Embabel->>Ollama: Connect to http://localhost:11434
    Ollama-->>Embabel: Return 16 available models
    Note over Embabel,Ollama: Models: qwen3 series, deepseek-r1, mistral-nemo,<br/>llama3 series, gemma2, codellama, etc.
    
    Embabel->>Embabel: Set default LLM: qwen2.5:latest
    Embabel->>Embabel: Set default embedding: nomic-embed-text:latest
    
    %% Tool and Agent Discovery Phase
    Embabel->>Embabel: Initialize MCP clients (0 found)
    Embabel->>Embabel: Register 6 tool groups (math, rag, etc.)
    
    Embabel->>Agent: Scan and deploy WriteAndReviewAgent
    Agent->>Agent: Analyze action bindings
    Note over Agent: craftStory: UserInput -> Story<br/>reviewStory: UserInput,Story -> ReviewedStory
    
    Embabel->>Shell: Initialize Spring Shell with Star Wars theme
    Shell-->>User: Ready to receive commands
    
    %% User Interaction and GOAP Planning Phase
    User->>Shell: x "给我讲个治愈的故事"
    Shell->>Embabel: Choose appropriate agent
    Embabel->>Embabel: Agent selection (confidence: 0.95)
    Embabel->>GOAP: Create process "hungry_chebyshev"
    
    %% Dynamic Planning Phase 1
    GOAP->>GOAP: Initial world state analysis
    Note over GOAP: {UserInput=TRUE, Story=FALSE,<br/>ReviewedStory=FALSE, hasRun_*=FALSE}
    GOAP->>GOAP: Formulate plan: craftStory -> reviewStory
    
    %% Action Execution Phase 1
    GOAP->>Agent: Execute craftStory action
    Agent->>Ollama: Generate story (temperature=0.9, creative persona)
    Ollama-->>Agent: Return generated story
    Agent-->>GOAP: Story object created
    
    %% Dynamic Replanning Phase
    GOAP->>GOAP: Update world state
    Note over GOAP: {UserInput=TRUE, Story=TRUE,<br/>hasRun_craftStory=TRUE, ReviewedStory=FALSE}
    GOAP->>GOAP: Replan: reviewStory only
    
    %% Action Execution Phase 2
    GOAP->>Agent: Execute reviewStory action
    Agent->>Ollama: Review story (temperature=0.5, reviewer persona)
    Ollama-->>Agent: Return review text
    Agent-->>GOAP: ReviewedStory object created
    
    %% Goal Achievement
    GOAP->>GOAP: Final world state verification
    Note over GOAP: {UserInput=TRUE, Story=TRUE,<br/>ReviewedStory=TRUE, hasRun_*=TRUE}
    GOAP->>GOAP: Goal achieved in 3.29 seconds
    
    GOAP-->>Shell: Return complete ReviewedStory
    Shell-->>User: Display story, review, and reviewer info

    %% Summary
    Note over User,Shell: Total execution: 3.29s<br/>LLM calls: 2 (qwen2.5:latest)<br/>Tokens: 453 prompt + 143 completion<br/>Cost: $0.0000
```

### Key Features

- **GOAP Dynamic Planning**: Plans and replans actions based on current world state
- **Multi-Persona LLM**: Uses different personas and temperatures for creative vs. analytical tasks  
- **Automatic Agent Selection**: Chooses appropriate agent based on user input
- **State Management**: Tracks execution state and available objects throughout workflow
- **Tool Integration**: Extensible tool system with 6 registered tool groups



